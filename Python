import asyncio
import logging
from aiogram import Bot, Dispatcher, types, F
from aiogram.filters import Command
from aiogram.types import WebAppInfo, MenuButtonWebApp
from aiogram.enums import ParseMode

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
BOT_TOKEN = "–í–ê–®_–¢–û–ö–ï–ù_–û–¢_@BotFather"
WEBAPP_URL = "https://–≤–∞—à-–¥–æ–º–µ–Ω.com/webapp"  # –∏–ª–∏ ngrok –¥–ª—è —Ç–µ—Å—Ç–∞

logging.basicConfig(level=logging.INFO)
bot = Bot(token=BOT_TOKEN)
dp = Dispatcher()

@dp.message(Command("start"))
async def cmd_start(message: types.Message):
    """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–æ–π Mini App"""
    
    keyboard = types.InlineKeyboardMarkup(inline_keyboard=[
        [types.InlineKeyboardButton(
            text="üß† –û—Ç–∫—Ä—ã—Ç—å Mindmap FM",
            web_app=WebAppInfo(url=WEBAPP_URL)
        )],
        [types.InlineKeyboardButton(
            text="üìö –û –º–µ—Ç–æ–¥–µ Stecco", 
            callback_data="about"
        )],
        [types.InlineKeyboardButton(
            text="‚ùì –ü–æ–º–æ—â—å", 
            callback_data="help"
        )]
    ])
    
    await message.answer(
        "üéØ <b>–§–∞—Å—Ü–∏–∞–ª—å–Ω—ã–µ –ú–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏</b>\n\n"
        "–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ —É—Ä–æ–≤–Ω–µ–π –ª–µ—á–µ–Ω–∏—è –ø–æ –º–µ—Ç–æ–¥—É Luigi Stecco.\n\n"
        "–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:",
        parse_mode=ParseMode.HTML,
        reply_markup=keyboard
    )

@dp.callback_query(F.data == "about")
async def about_callback(callback: types.CallbackQuery):
    await callback.message.edit_text(
        "üìñ <b>–ú–µ—Ç–æ–¥ Stecco</b>\n\n"
        "–§–∞—Å—Ü–∏–∞–ª—å–Ω–∞—è –º–∞–Ω–∏–ø—É–ª—è—Ü–∏—è ‚Äî —ç—Ç–æ –º–µ—Ç–æ–¥–∏–∫–∞ –ª–µ—á–µ–Ω–∏—è, "
        "—Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è Luigi Stecco, —Ñ–∏–∑–∏–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç–æ–º –∏–∑ –ò—Ç–∞–ª–∏–∏.\n\n"
        "<b>4 —É—Ä–æ–≤–Ω—è –ª–µ—á–µ–Ω–∏—è:</b>\n"
        "‚Ä¢ I-II: –î–≤–∏–≥–∞—Ç–µ–ª—å–Ω—ã–π –∞–ø–ø–∞—Ä–∞—Ç\n"
        "‚Ä¢ III: –¢–µ–Ω–æ—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ —Ü–µ–ø–æ—á–∫–∏\n"
        "‚Ä¢ IV: –°–∏—Å—Ç–µ–º—ã (–ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–∞—è —Ñ–∞—Å—Ü–∏—è)\n\n"
        "–ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ä—Ç–µ ‚¨áÔ∏è",
        parse_mode=ParseMode.HTML,
        reply_markup=types.InlineKeyboardMarkup(inline_keyboard=[
            [types.InlineKeyboardButton(
                text="üß† –û—Ç–∫—Ä—ã—Ç—å Mindmap", 
                web_app=WebAppInfo(url=WEBAPP_URL)
            )]
        ])
    )

@dp.callback_query(F.data == "help")
async def help_callback(callback: types.CallbackQuery):
    await callback.answer(
        "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é. "
        "–ù–∞–∂–º–∏—Ç–µ 'üß† –û—Ç–∫—Ä—ã—Ç—å Mindmap FM' –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ä—Ç—ã.",
        show_alert=True
    )

async def main():
    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é
    await bot.set_chat_menu_button(
        menu_button=MenuButtonWebApp(
            text="Mindmap FM",
            web_app=WebAppInfo(url=WEBAPP_URL)
        )
    )
    
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
